"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parse = void 0;
const html_parser_1 = require("@markuplint/html-parser");
const parser_utils_1 = require("@markuplint/parser-utils");
const parse = rawCode => {
    const blocks = (0, parser_utils_1.ignoreBlock)(rawCode, [
        {
            type: 'ejs-whitespace-slurping',
            start: /<%_/,
            end: /%>/,
        },
        {
            type: 'ejs-output-value',
            start: /<%=/,
            end: /%>/,
        },
        {
            type: 'ejs-output-unescaped',
            start: /<%-/,
            end: /%>/,
        },
        {
            type: 'ejs-comment',
            start: /<%#/,
            end: /%>/,
        },
        {
            type: 'ejs-scriptlet',
            start: /<%(?!%)/,
            end: /%>/,
        },
    ]);
    const doc = (0, html_parser_1.parse)(blocks.replaced);
    doc.nodeList = (0, parser_utils_1.restoreNode)(doc.nodeList, blocks);
    return doc;
};
exports.parse = parse;
